{% extends "core/tutor/base_tutor.html" %}

{% block title %}Student Detail{% endblock %}

{% block content %}
<div class="page-header">
  <div>
    <h1 class="page-title">Student Report</h1>
    <p class="page-subtitle">Diagnostic details for <strong>{{ student.user.username }}</strong></p>
  </div>

  <div class="page-actions">
    <a class="btn btn-ghost" href="{% url 'tutor_students' %}">← Back</a>
  </div>
</div>

<div class="grid-2">
  <!-- Profile -->
  <div class="card card-pad">
    <h2 class="section-title">Profile</h2>

    <div class="kv">
      <div class="kv-row">
        <div class="kv-k">Student</div>
        <div class="kv-v">{{ student.user.username }}</div>
      </div>

      <div class="kv-row">
        <div class="kv-k">Grade</div>
        <div class="kv-v">{{ student.grade_level }}</div>
      </div>

      <div class="kv-row">
        <div class="kv-k">Latest Diagnostic</div>
        <div class="kv-v">
          {% if latest %}
            <span class="badge badge-primary">{{ latest.percent_score|floatformat:0 }}%</span>
          {% else %}
            <span class="badge badge-muted">No diagnostic yet</span>
          {% endif %}
        </div>
      </div>

      <div class="kv-row">
        <div class="kv-k">Weakest Topic</div>
        <div class="kv-v">
          {% if weakest_topic %}
            <span class="badge badge-soft">{{ weakest_topic }}</span>
          {% else %}
            <span class="muted">—</span>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="card-foot">
      <a class="link" href="{% url 'tutor_students' %}">View all students →</a>
    </div>
  </div>

  <!-- Latest attempt -->
  <div class="card card-pad">
    <h2 class="section-title">Latest Attempt</h2>

    {% if latest %}
      <div class="stats">
        <div class="stat">
          <div class="stat-k">Score</div>
          <div class="stat-v">{{ latest.percent_score|floatformat:0 }}%</div>
        </div>

        <div class="stat">
          <div class="stat-k">Correct</div>
          <div class="stat-v">{{ latest.correct_answers }}</div>
        </div>

        <div class="stat">
          <div class="stat-k">Total</div>
          <div class="stat-v">{{ latest.total_questions }}</div>
        </div>
      </div>

      <div class="muted" style="margin-top: 10px;">
        Submitted: {{ latest.created_at|date:"M d, Y • H:i" }}
      </div>
    {% else %}
      <p class="muted">No diagnostic attempt has been submitted yet.</p>
    {% endif %}
  </div>
</div>

<!-- Attempts history -->
<div class="card card-pad" style="margin-top: 14px;">
  <h2 class="section-title">History</h2>

  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Score</th>
          <th>Correct</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        {% for r in results %}
        <tr>
          <td>{{ r.created_at|date:"M d, Y • H:i" }}</td>
          <td><span class="badge badge-primary">{{ r.percent_score|floatformat:0 }}%</span></td>
          <td>{{ r.correct_answers }}</td>
          <td>{{ r.total_questions }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="4" class="muted">No history yet.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
